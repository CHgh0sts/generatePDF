(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,618566,(e,r,t)=>{r.exports=e.r(976562)},181692,e=>{"use strict";let r=(0,e.i(475254).default)("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);e.s(["default",()=>r])},475254,258541,e=>{"use strict";var r=e.i(271645);let t=e=>{let r=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,t)=>t?t.toUpperCase():r.toLowerCase());return r.charAt(0).toUpperCase()+r.slice(1)},s=(...e)=>e.filter((e,r,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===r).join(" ").trim();var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:l=2,absoluteStrokeWidth:n,className:i="",children:d,iconNode:o,...c},u)=>(0,r.createElement)("svg",{ref:u,...a,width:t,height:t,stroke:e,strokeWidth:n?24*Number(l)/Number(t):l,className:s("lucide",i),...!d&&!(e=>{for(let r in e)if(r.startsWith("aria-")||"role"===r||"title"===r)return!0})(c)&&{"aria-hidden":"true"},...c},[...o.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(d)?d:[d]]));e.s(["default",()=>l],258541);let n=(e,a)=>{let n=(0,r.forwardRef)(({className:n,...i},d)=>(0,r.createElement)(l,{ref:d,iconNode:a,className:s(`lucide-${t(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,n),...i}));return n.displayName=t(e),n};e.s(["default",()=>n],475254)},603908,e=>{"use strict";let r=(0,e.i(475254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["default",()=>r])},107233,e=>{"use strict";var r=e.i(603908);e.s(["Plus",()=>r.default])},727612,612329,e=>{"use strict";let r=(0,e.i(475254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["default",()=>r],612329),e.s(["Trash2",()=>r],727612)},180127,e=>{"use strict";let r=(0,e.i(475254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["default",()=>r])},871689,e=>{"use strict";var r=e.i(180127);e.s(["ArrowLeft",()=>r.default])},834161,e=>{"use strict";var r=e.i(181692);e.s(["Key",()=>r.default])},469205,e=>{"use strict";let r=(0,e.i(475254).default)("test-tube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);e.s(["default",()=>r])},703615,e=>{"use strict";var r=e.i(469205);e.s(["TestTube",()=>r.default])},792995,e=>{"use strict";var r=e.i(843476),t=e.i(271645),s=e.i(618566),a=e.i(522016),l=e.i(871689),n=e.i(107233),i=e.i(727612),d=e.i(834161),o=e.i(703615);function c(){let e=(0,s.useRouter)(),c=(0,s.useParams)().id,[u,m]=(0,t.useState)([]),[x,p]=(0,t.useState)(!0),[h,g]=(0,t.useState)(!1),[b,y]=(0,t.useState)({name:"",slug:"",templateId:"",responseType:"download",requireApiKey:!1,apiKey:""}),[f,j]=(0,t.useState)([]),[v,N]=(0,t.useState)('{\n  "client": {\n    "nom": "Entreprise ABC"\n  }\n}'),[w,k]=(0,t.useState)(!1);(0,t.useEffect)(()=>{C(),A()},[c]);let C=async()=>{try{let e=await fetch("/api/templates"),r=await e.json();m(r)}catch(e){console.error("Erreur chargement templates:",e)}},A=async()=>{try{let r=await fetch(`/api/routes/${c}`);if(!r.ok)return void e.push("/dashboard/generateroute");let t=await r.json();y({name:t.name,slug:t.slug,templateId:t.templateId,responseType:t.responseType,requireApiKey:!!t.apiKey,apiKey:t.apiKey||""});try{let e=JSON.parse(t.variableMapping),r=Object.entries(e).map(([e,r])=>({id:crypto.randomUUID(),jsonPath:e,templateVar:r}));j(r)}catch(e){j([])}}catch(r){console.error("Erreur chargement route:",r),e.push("/dashboard/generateroute")}finally{p(!1)}},T=(e,r,t)=>{j(f.map(s=>s.id===e?{...s,[r]:t}:s))},S=async r=>{r.preventDefault(),g(!0);try{let r={};f.forEach(e=>{e.jsonPath&&e.templateVar&&(r[e.jsonPath]=e.templateVar)}),(await fetch(`/api/routes/${c}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:b.name,slug:b.slug,templateId:b.templateId,responseType:b.responseType,apiKey:b.requireApiKey?b.apiKey:null,variableMapping:JSON.stringify(r)})})).ok?e.push("/dashboard/generateroute"):alert("Erreur lors de la modification de la route")}catch(e){console.error("Erreur:",e),alert("Erreur lors de la modification de la route")}finally{g(!1)}},K=async()=>{try{JSON.parse(v),alert("Test rÃ©ussi ! Les donnÃ©es JSON sont valides.\n\nAprÃ¨s sauvegarde, vous pourrez tester la gÃ©nÃ©ration complÃ¨te du PDF.")}catch(e){alert("Erreur: JSON invalide\n\n"+e.message)}};return x?(0,r.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent mx-auto"}),(0,r.jsx)("p",{className:"text-gray-600 mt-4",children:"Chargement..."})]})}):(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)(a.default,{href:"/dashboard/generateroute",className:"inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4",children:[(0,r.jsx)(l.ArrowLeft,{size:20}),"Retour aux routes"]}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Modifier la Route API"}),(0,r.jsx)("p",{className:"text-gray-700 mt-2",children:"Modifiez la configuration de votre route"})]}),(0,r.jsxs)("form",{onSubmit:S,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Informations de base"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-800 mb-1",children:"Nom de la route"}),(0,r.jsx)("input",{type:"text",required:!0,value:b.name,onChange:e=>y({...b,name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: Facture Client A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-800 mb-1",children:"Slug (URL)"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-gray-600 text-sm",children:"/api/generate/"}),(0,r.jsx)("input",{type:"text",required:!0,value:b.slug,onChange:e=>y({...b,slug:e.target.value}),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm",placeholder:"facture-client-a"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-800 mb-1",children:"ModÃ¨le PDF"}),(0,r.jsxs)("select",{required:!0,value:b.templateId,onChange:e=>y({...b,templateId:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"",children:"SÃ©lectionner un modÃ¨le"}),u.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-800 mb-1",children:"Type de rÃ©ponse"}),(0,r.jsxs)("select",{value:b.responseType,onChange:e=>y({...b,responseType:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"download",children:"TÃ©lÃ©chargement direct (PDF)"}),(0,r.jsx)("option",{value:"base64",children:"Base64 (JSON)"}),(0,r.jsx)("option",{value:"url",children:"URL du fichier"})]})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,r.jsxs)("h2",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,r.jsx)(d.Key,{size:20}),"SÃ©curitÃ© (optionnel)"]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:b.requireApiKey,onChange:e=>y({...b,requireApiKey:e.target.checked}),className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-800",children:"RequÃ©rir une clÃ© API pour accÃ©der Ã  cette route"})]}),b.requireApiKey&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-800 mb-1",children:"ClÃ© API"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",readOnly:!0,value:b.apiKey,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-900 font-mono text-sm"}),(0,r.jsx)("button",{type:"button",onClick:()=>{let e="sk_"+Array.from(crypto.getRandomValues(new Uint8Array(24))).map(e=>e.toString(16).padStart(2,"0")).join("");y(r=>({...r,apiKey:e}))},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"RÃ©gÃ©nÃ©rer"})]}),(0,r.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["Cette clÃ© devra Ãªtre envoyÃ©e dans le header ",(0,r.jsx)("code",{className:"bg-gray-100 px-1 rounded",children:"X-API-Key"})]})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Mapping des variables"}),(0,r.jsxs)("button",{type:"button",onClick:()=>{j([...f,{id:crypto.randomUUID(),jsonPath:"",templateVar:""}])},className:"px-3 py-1.5 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors flex items-center gap-1 text-sm",children:[(0,r.jsx)(n.Plus,{size:16}),"Ajouter"]})]}),(0,r.jsxs)("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-100 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-sm font-bold text-blue-900 mb-2",children:"ðŸ’¡ Comment mapper les variables ?"}),(0,r.jsxs)("div",{className:"space-y-2 text-xs text-blue-800",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"Variables simples :"}),(0,r.jsx)("div",{className:"mt-1 font-mono bg-white p-2 rounded border border-blue-200",children:(0,r.jsxs)("div",{className:"text-gray-700",children:["JSON : ",(0,r.jsx)("code",{children:"client.nom"})," â†’ Template : ",(0,r.jsx)("code",{children:"{{clientName}}"})]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"Boucles sur tableaux (pour remplir les lignes d'un tableau) :"}),(0,r.jsxs)("div",{className:"mt-1 font-mono bg-white p-2 rounded border border-blue-200",children:[(0,r.jsxs)("div",{className:"text-gray-700",children:["JSON : ",(0,r.jsx)("code",{children:"depenses[].prixTTC"})," â†’ Template : ",(0,r.jsx)("code",{children:"{{prixTTC}}"})]}),(0,r.jsxs)("div",{className:"text-gray-700 mt-1",children:["JSON : ",(0,r.jsx)("code",{children:"depenses[].description"})," â†’ Template : ",(0,r.jsx)("code",{children:"{{desc}}"})]})]}),(0,r.jsxs)("p",{className:"mt-1 text-blue-700",children:["âš ï¸ Utilisez ",(0,r.jsx)("code",{children:"[]"})," pour indiquer une boucle. Si ",(0,r.jsx)("code",{children:"depenses"})," contient 3 Ã©lÃ©ments, 3 lignes seront gÃ©nÃ©rÃ©es."]})]})]})]}),0===f.length?(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("p",{className:"mb-3",children:"Aucun mapping de variable"}),(0,r.jsx)("p",{className:"text-sm text-gray-400",children:'Cliquez sur "Ajouter" pour crÃ©er un mapping'})]}):(0,r.jsx)("div",{className:"space-y-3",children:f.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("input",{type:"text",value:e.jsonPath,onChange:r=>T(e.id,"jsonPath",r.target.value),placeholder:"client.nom",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 text-sm font-mono focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),(0,r.jsx)("span",{className:"text-gray-400",children:"â†’"}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("input",{type:"text",value:e.templateVar,onChange:r=>T(e.id,"templateVar",r.target.value),placeholder:"{{clientName}}",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 text-sm font-mono focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),(0,r.jsx)("button",{type:"button",onClick:()=>{var r;return r=e.id,void j(f.filter(e=>e.id!==r))},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Supprimer",children:(0,r.jsx)(i.Trash2,{size:18})})]},e.id))}),(0,r.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-100",children:(0,r.jsxs)("p",{className:"text-xs text-blue-800",children:[(0,r.jsx)("strong",{children:"ðŸ’¡ Astuce:"})," Le chemin JSON utilise la notation pointÃ©e (ex: ",(0,r.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"client.nom"})," pour accÃ©der Ã  ",(0,r.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:'{"client": {"nom": "..."}}'}),")"]})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h2",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[(0,r.jsx)(o.TestTube,{size:20}),"Tester avec des donnÃ©es"]}),(0,r.jsx)("button",{type:"button",onClick:()=>k(!w),className:"text-sm text-blue-600 hover:text-blue-700",children:w?"Masquer":"Afficher"})]}),w&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("textarea",{value:v,onChange:e=>N(e.target.value),className:"w-full h-48 px-4 py-3 border border-gray-300 rounded-lg text-gray-900 font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:'{"client": {"nom": "Test"}}'}),(0,r.jsx)("button",{type:"button",onClick:K,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Valider le JSON"})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,r.jsx)(a.default,{href:"/dashboard/generateroute",className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Annuler"}),(0,r.jsx)("button",{type:"submit",disabled:h,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Enregistrement...":"Enregistrer les modifications"})]})]})]})}e.s(["default",()=>c])}]);